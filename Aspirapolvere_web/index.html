<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Test GLTFLoader UMD</title>
<style>body { margin:0; overflow:hidden; }</style>
</head>
<body>
<button id="playAnimations" style="position:absolute;top:10px;left:10px;z-index:10;display:none;">Avvia Animazioni</button>
<script src="https://cdn.jsdelivr.net/npm/three@0.149.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.149.0/examples/js/loaders/GLTFLoader.js"></script>
<script>
  let scene, camera, renderer, mixer;
  const clock = new THREE.Clock();

  function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.z = 5;

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const loader = new THREE.GLTFLoader();

    loader.load('animazione_web.glb', function(gltf){
      scene.add(gltf.scene);
      mixer = new THREE.AnimationMixer(gltf.scene);

      gltf.animations.forEach((clip) => {
        mixer.clipAction(clip);
      });

      document.getElementById('playAnimations').style.display = 'block';

      animate();
    }, undefined, function(error){
      console.error('Errore caricamento modello:', error);
    });

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    document.getElementById('playAnimations').addEventListener('click', () => {
      if(!mixer) return;
      mixer._actions.forEach(action => action.play());
      document.getElementById('playAnimations').style.display = 'none';
    });
  }

  function animate() {
    requestAnimationFrame(animate);
    const delta = clock.getDelta();
    if(mixer) mixer.update(delta);
    renderer.render(scene, camera);
  }

  init();
</script>
</body>
</html>